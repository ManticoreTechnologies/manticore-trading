<!DOCTYPE html>
<html>
<head>
    <title>Manticore Trading API Documentation</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
            background: #fff;
        }
        h1, h2, h3 {
            color: #2c3e50;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        .endpoint {
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 4px 4px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            margin-right: 10px;
        }
        .get { background: #61affe; color: white; }
        .post { background: #49cc90; color: white; }
        .patch { background: #fca130; color: white; }
        .delete { background: #f93e3e; color: white; }
        .ws { background: #9069cd; color: white; }
        .path {
            font-family: monospace;
            font-size: 1.1em;
            color: #3498db;
        }
        .params {
            margin-left: 20px;
        }
        .param-name {
            font-family: monospace;
            color: #e83e8c;
        }
        .param-type {
            color: #6c757d;
            font-style: italic;
        }
        .response {
            background: #edf2f7;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        code {
            background: #272822;
            color: #f8f8f2;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: monospace;
        }
        pre {
            background: #272822;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .section-nav {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            position: sticky;
            top: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section-nav ul {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        .section-nav li {
            margin: 10px 0;
        }
        .section-nav a {
            color: #3498db;
            text-decoration: none;
            display: block;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        .section-nav a:hover {
            background-color: #e9ecef;
        }
        .note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 4px 4px 0;
        }
        .example {
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .tab-container {
            margin: 20px 0;
        }
        .tab-buttons {
            margin-bottom: 10px;
        }
        .tab-button {
            padding: 8px 16px;
            border: none;
            background: #e9ecef;
            cursor: pointer;
            border-radius: 4px;
            margin-right: 5px;
        }
        .tab-button.active {
            background: #3498db;
            color: white;
        }
        .tab-content {
            display: none;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 4px;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <h1>Manticore Trading API Documentation</h1>

    <div class="section-nav">
        <h3>Quick Navigation</h3>
        <ul>
            <li><a href="#auth">Authentication</a></li>
            <li><a href="#profile">Profile Management</a></li>
            <li><a href="#listings">Listings</a></li>
            <li><a href="#orders">Orders</a></li>
            <li><a href="#market">Market Data</a></li>
            <li><a href="#websockets">WebSocket Updates</a></li>
            <li><a href="#notifications">Notifications</a></li>
            <li><a href="#system">System Status</a></li>
        </ul>
    </div>

    <section id="auth">
        <h2>Authentication</h2>
        <p>
            Authentication uses Evrmore's message signing system. The flow is:
            1. Request a challenge for your address
            2. Sign the challenge message with your Evrmore wallet
            3. Submit the signature to receive a JWT token
            4. Use the JWT token in the Authorization header for authenticated requests
        </p>

        <div class="endpoint">
            <span class="method post">POST</span>
            <span class="path">/auth/challenge</span>
            <p>Get a challenge to sign with your Evrmore wallet</p>
            <div class="params">
                <h4>Request Body:</h4>
                <pre>
{
    "address": "string"  // Your Evrmore address
}</pre>
                <h4>Response:</h4>
                <pre>
{
    "challenge_id": "string",  // Save this for the login request
    "message": "string",       // Sign this message with your wallet
    "expires_at": "string"     // ISO-8601 timestamp
}</pre>
            </div>
        </div>

        <div class="endpoint">
            <span class="method post">POST</span>
            <span class="path">/auth/login</span>
            <p>Exchange a signed challenge for a JWT token</p>
            <div class="params">
                <h4>Request Body:</h4>
                <pre>
{
    "challenge_id": "string",
    "address": "string",
    "signature": "string"
}</pre>
                <h4>Response:</h4>
                <pre>
{
    "token": "string"  // JWT token for Authorization header
}</pre>
            </div>
        </div>

        <div class="endpoint">
            <span class="method get">GET</span>
            <span class="path">/auth/verify</span>
            <p>Verify a JWT token is valid</p>
            <div class="params">
                <h4>Headers:</h4>
                <ul>
                    <li><span class="param-name">Authorization</span>: Bearer {token}</li>
                </ul>
                <h4>Response:</h4>
                <pre>
{
    "valid": true,
    "address": "string"
}</pre>
            </div>
        </div>
    </section>

    <section id="profile">
        <h2>Profile Management</h2>
        <p>Manage user profiles and preferences. All endpoints require authentication.</p>

        <div class="endpoint">
            <span class="method get">GET</span>
            <span class="path">/profile</span>
            <p>Get the authenticated user's profile</p>
            <div class="params">
                <h4>Headers:</h4>
                <ul>
                    <li><span class="param-name">Authorization</span>: Bearer {token}</li>
                </ul>
                <h4>Response:</h4>
                <pre>
{
    "address": "string",
    "friendly_name": "string",
    "bio": "string",
    "profile_ipfs": "string",
    "status": "string",
    "favorite_assets": ["string"]
}</pre>
            </div>
        </div>

        <div class="endpoint">
            <span class="method patch">PATCH</span>
            <span class="path">/profile</span>
            <p>Update profile information</p>
            <div class="params">
                <h4>Headers:</h4>
                <ul>
                    <li><span class="param-name">Authorization</span>: Bearer {token}</li>
                </ul>
                <h4>Request Body:</h4>
                <pre>
{
    "friendly_name": "string",  // optional
    "bio": "string",           // optional
    "profile_ipfs": "string"   // optional
}</pre>
            </div>
        </div>

        <div class="endpoint">
            <span class="method post">POST</span>
            <span class="path">/profile/image</span>
            <p>Upload a profile image</p>
            <div class="params">
                <h4>Headers:</h4>
                <ul>
                    <li><span class="param-name">Authorization</span>: Bearer {token}</li>
                    <li><span class="param-name">Content-Type</span>: multipart/form-data</li>
                </ul>
                <h4>Form Data:</h4>
                <ul>
                    <li><span class="param-name">file</span>: Image file (jpg/png)</li>
                </ul>
                <h4>Response:</h4>
                <pre>
{
    "ipfs_hash": "string"
}</pre>
            </div>
        </div>
    </section>

    <section id="listings">
        <h2>Listings</h2>
        <p>Create and manage listings. Most endpoints require authentication.</p>

        <div class="endpoint">
            <span class="method post">POST</span>
            <span class="path">/listings</span>
            <p>Create a new listing</p>
            <div class="params">
                <h4>Headers:</h4>
                <ul>
                    <li><span class="param-name">Authorization</span>: Bearer {token}</li>
                </ul>
                <h4>Request Body:</h4>
                <pre>
{
    "seller_address": "string",
    "name": "string",
    "description": "string",
    "image_ipfs_hash": "string",  // optional
    "prices": [{
        "asset_name": "string",
        "price_evr": "decimal",
        "units": "integer"
    }],
    "tags": ["string"]  // optional
}</pre>
                <h4>Response:</h4>
                <pre>
{
    "id": "uuid",
    "seller_address": "string",
    "listing_address": "string",
    "deposit_address": "string",
    "name": "string",
    "description": "string",
    "image_ipfs_hash": "string",
    "status": "string",
    "created_at": "string",
    "updated_at": "string",
    "prices": [{
        "asset_name": "string",
        "price_evr": "string",
        "units": "integer",
        "created_at": "string",
        "updated_at": "string"
    }],
    "balances": [{
        "asset_name": "string",
        "confirmed_balance": "string",
        "pending_balance": "string",
        "units": "integer",
        "last_confirmed_tx_hash": "string",
        "last_confirmed_tx_time": "string"
    }]
}</pre>
            </div>
        </div>

        <div class="endpoint">
            <span class="method get">GET</span>
            <span class="path">/listings/search</span>
            <p>Search listings with filters</p>
            <div class="params">
                <h4>Query Parameters:</h4>
                <ul>
                    <li><span class="param-name">search_term</span>: Text search</li>
                    <li><span class="param-name">seller_address</span>: Filter by seller</li>
                    <li><span class="param-name">asset_name</span>: Filter by asset</li>
                    <li><span class="param-name">min_price_evr</span>: Minimum price</li>
                    <li><span class="param-name">max_price_evr</span>: Maximum price</li>
                    <li><span class="param-name">status</span>: Listing status</li>
                    <li><span class="param-name">tags</span>: Filter by tags</li>
                    <li><span class="param-name">per_page</span>: Results per page</li>
                    <li><span class="param-name">page</span>: Page number</li>
                </ul>
            </div>
        </div>
    </section>

    <section id="websockets">
        <h2>WebSocket Updates</h2>
        <p>Real-time updates for listings, orders, and market data</p>

        <div class="endpoint">
            <span class="method ws">WS</span>
            <span class="path">/ws/listings</span>
            <p>Receive real-time listing updates</p>
            <div class="params">
                <h4>Message Types:</h4>
                <ul>
                    <li>New Listing Created:
                        <pre>
{
    "type": "update",
    "channel": "listings",
    "data": {
        "update_type": "new",
        "listing": {...}
    }
}</pre>
                    </li>
                    <li>Listing Updated:
                        <pre>
{
    "type": "update",
    "channel": "listings",
    "data": {
        "update_type": "modified",
        "listing_id": "string",
        "changes": {...}
    }
}</pre>
                    </li>
                    <li>Listing Status Changed:
                        <pre>
{
    "type": "update",
    "channel": "listings",
    "data": {
        "listing_id": "string",
        "update_type": "status",
        "old_status": "string",
        "new_status": "string"
    }
}</pre>
                    </li>
                    <li>Balance Update:
                        <pre>
{
    "type": "update",
    "channel": "listings",
    "data": {
        "listing_id": "string",
        "update_type": "balance",
        "balances": {
            "asset_name": {
                "confirmed_balance": "string",
                "pending_balance": "string"
            }
        }
    }
}</pre>
                    </li>
                </ul>
            </div>
        </div>

        <div class="endpoint">
            <span class="method ws">WS</span>
            <span class="path">/ws/orders</span>
            <p>Receive real-time order updates</p>
            <div class="params">
                <h4>Message Types:</h4>
                <ul>
                    <li>New Order:
                        <pre>
{
    "type": "update",
    "channel": "orders",
    "data": {
        "update_type": "new",
        "order": {...}
    }
}</pre>
                    </li>
                    <li>Order Status Update:
                        <pre>
{
    "type": "update",
    "channel": "orders",
    "data": {
        "order_id": "string",
        "update_type": "status",
        "old_status": "string",
        "new_status": "string"
    }
}</pre>
                    </li>
                </ul>
            </div>
        </div>

        <div class="endpoint">
            <span class="method ws">WS</span>
            <span class="path">/ws/market</span>
            <p>Receive market data updates</p>
            <div class="params">
                <h4>Message Types:</h4>
                <ul>
                    <li>Price Update:
                        <pre>
{
    "type": "update",
    "channel": "market",
    "data": {
        "update_type": "price",
        "asset_name": "string",
        "price_evr": "string",
        "change_24h": "string"
    }
}</pre>
                    </li>
                    <li>Trading Volume:
                        <pre>
{
    "type": "update",
    "channel": "market",
    "data": {
        "update_type": "volume",
        "asset_name": "string",
        "volume_24h": "string"
    }
}</pre>
                    </li>
                </ul>
            </div>
        </div>
    </section>

    <section id="notifications">
        <h2>Notifications</h2>
        <p>Real-time notifications and alerts. Requires authentication.</p>

        <div class="endpoint">
            <span class="method ws">WS</span>
            <span class="path">/notifications/stream?user_address={address}</span>
            <p>WebSocket endpoint for real-time notifications</p>
            <div class="params">
                <h4>Message Types:</h4>
                <pre>
{
    "type": "notification",
    "data": {
        "id": "string",
        "type": "string",
        "title": "string",
        "message": "string",
        "data": {...},
        "created_at": "string"
    }
}</pre>
            </div>
        </div>

        <div class="endpoint">
            <span class="method get">GET</span>
            <span class="path">/notifications/unread/{user_address}</span>
            <p>Get unread notifications</p>
            <div class="params">
                <h4>Headers:</h4>
                <ul>
                    <li><span class="param-name">Authorization</span>: Bearer {token}</li>
                </ul>
                <h4>Query Parameters:</h4>
                <ul>
                    <li><span class="param-name">limit</span>: Results per page</li>
                    <li><span class="param-name">offset</span>: Pagination offset</li>
                </ul>
            </div>
        </div>
    </section>

    <script>
        // Add smooth scrolling to navigation links
        document.querySelectorAll('.section-nav a').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        // Highlight current section in navigation
        window.addEventListener('scroll', () => {
            let current = '';
            document.querySelectorAll('section').forEach(section => {
                const sectionTop = section.offsetTop;
                if (pageYOffset >= sectionTop - 60) {
                    current = section.getAttribute('id');
                }
            });

            document.querySelectorAll('.section-nav a').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href').substring(1) === current) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>
</html>

