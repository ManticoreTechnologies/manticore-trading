<!DOCTYPE html>
<html>
<head>
    <title>Manticore Trading API Documentation</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        .endpoint {
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 4px 4px 0;
        }
        .method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            margin-right: 10px;
        }
        .get { background: #61affe; color: white; }
        .post { background: #49cc90; color: white; }
        .delete { background: #f93e3e; color: white; }
        .path {
            font-family: monospace;
            font-size: 1.1em;
            color: #3498db;
        }
        .params {
            margin-left: 20px;
        }
        .param-name {
            font-family: monospace;
            color: #e83e8c;
        }
        .param-type {
            color: #6c757d;
            font-style: italic;
        }
        .response {
            background: #edf2f7;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        code {
            background: #272822;
            color: #f8f8f2;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: monospace;
        }
        pre {
            background: #272822;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .section-nav {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .section-nav ul {
            list-style-type: none;
            padding: 0;
        }
        .section-nav li {
            margin: 5px 0;
        }
        .section-nav a {
            color: #3498db;
            text-decoration: none;
        }
        .section-nav a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>Manticore Trading API Documentation</h1>

    <div class="section-nav">
        <h3>Quick Navigation</h3>
        <ul>
            <li><a href="#listings">Listings Endpoints</a></li>
            <li><a href="#transactions">Transaction Endpoints</a></li>
            <li><a href="#orders">Order Endpoints</a></li>
            <li><a href="#cart">Cart Order Endpoints</a></li>
            <li><a href="#management">Listing Management Endpoints</a></li>
            <li><a href="#operations">Listing Operations</a></li>
            <li><a href="#testing">Testing Endpoints</a></li>
            <li><a href="#formats">Response Formats</a></li>
        </ul>
    </div>
    
    <h2 id="listings">Listings Endpoints</h2>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/listings</span>
        <p>Get all listings with pagination metadata</p>
        <div class="params">
            <h4>Query Parameters:</h4>
            <ul>
                <li><span class="param-name">per_page</span> <span class="param-type">(integer, default: 50)</span>: Number of results per page</li>
                <li><span class="param-name">page</span> <span class="param-type">(integer, default: 1)</span>: Page number</li>
            </ul>
        </div>
    </div>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/listings/search</span>
        <p>Search listings with various filters and pagination</p>
        <div class="params">
            <h4>Query Parameters:</h4>
            <ul>
                <li><span class="param-name">search_term</span> <span class="param-type">(string, optional)</span>: Text to search in name/description</li>
                <li><span class="param-name">seller_address</span> <span class="param-type">(string, optional)</span>: Filter by seller address</li>
                <li><span class="param-name">asset_name</span> <span class="param-type">(string, optional)</span>: Filter by asset name</li>
                <li><span class="param-name">min_price_evr</span> <span class="param-type">(decimal, optional)</span>: Minimum price in EVR</li>
                <li><span class="param-name">max_price_evr</span> <span class="param-type">(decimal, optional)</span>: Maximum price in EVR</li>
                <li><span class="param-name">status</span> <span class="param-type">(string, optional)</span>: Filter by listing status</li>
                <li><span class="param-name">tags</span> <span class="param-type">(array of strings, optional)</span>: Filter by tags</li>
                <li><span class="param-name">per_page</span> <span class="param-type">(integer, default: 50)</span>: Number of results per page</li>
                <li><span class="param-name">page</span> <span class="param-type">(integer, default: 1)</span>: Page number</li>
            </ul>
        </div>
    </div>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/listings/by-id/{listing_id}</span>
        <p>Get a specific listing by its ID</p>
        <div class="params">
            <h4>Path Parameters:</h4>
            <ul>
                <li><span class="param-name">listing_id</span> <span class="param-type">(string)</span>: The listing's UUID</li>
            </ul>
        </div>
    </div>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/listings/by-deposit-address/{deposit_address}</span>
        <p>Get a listing by its deposit address</p>
        <div class="params">
            <h4>Path Parameters:</h4>
            <ul>
                <li><span class="param-name">deposit_address</span> <span class="param-type">(string)</span>: The listing's deposit address</li>
            </ul>
        </div>
    </div>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/listings/by-seller-address/{seller_address}</span>
        <p>Get all listings for a specific seller</p>
        <div class="params">
            <h4>Path Parameters:</h4>
            <ul>
                <li><span class="param-name">seller_address</span> <span class="param-type">(string)</span>: The seller's address</li>
            </ul>
        </div>
    </div>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/listings/by-asset-name/{asset_name}</span>
        <p>Get all listings for a specific asset</p>
        <div class="params">
            <h4>Path Parameters:</h4>
            <ul>
                <li><span class="param-name">asset_name</span> <span class="param-type">(string)</span>: The asset name</li>
            </ul>
        </div>
    </div>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/listings/by-tag/{tag}</span>
        <p>Get all listings with a specific tag</p>
        <div class="params">
            <h4>Path Parameters:</h4>
            <ul>
                <li><span class="param-name">tag</span> <span class="param-type">(string)</span>: The tag to filter by</li>
            </ul>
            <h4>Query Parameters:</h4>
            <ul>
                <li><span class="param-name">per_page</span> <span class="param-type">(integer, default: 50)</span>: Number of results per page</li>
                <li><span class="param-name">page</span> <span class="param-type">(integer, default: 1)</span>: Page number</li>
            </ul>
        </div>
    </div>

    <h2 id="transactions">Transaction Endpoints</h2>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/listings/transactions/{address}</span>
        <p>Get transaction history for a specific address</p>
        <div class="params">
            <h4>Path Parameters:</h4>
            <ul>
                <li><span class="param-name">address</span> <span class="param-type">(string)</span>: The address to get transactions for</li>
            </ul>
            <h4>Query Parameters:</h4>
            <ul>
                <li><span class="param-name">asset_name</span> <span class="param-type">(string, optional)</span>: Filter by asset name</li>
                <li><span class="param-name">entry_type</span> <span class="param-type">(string, optional)</span>: Filter by entry type (receive/withdraw)</li>
                <li><span class="param-name">min_confirmations</span> <span class="param-type">(integer, optional)</span>: Minimum number of confirmations</li>
                <li><span class="param-name">per_page</span> <span class="param-type">(integer, default: 50)</span>: Number of results per page</li>
                <li><span class="param-name">page</span> <span class="param-type">(integer, default: 1)</span>: Page number</li>
            </ul>
        </div>
    </div>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/listings/{listing_id}/transactions</span>
        <p>Get all transactions for a specific listing (both deposit and listing address)</p>
        <div class="params">
            <h4>Path Parameters:</h4>
            <ul>
                <li><span class="param-name">listing_id</span> <span class="param-type">(string)</span>: The listing's UUID</li>
            </ul>
            <h4>Query Parameters:</h4>
            <ul>
                <li><span class="param-name">asset_name</span> <span class="param-type">(string, optional)</span>: Filter by asset name</li>
                <li><span class="param-name">entry_type</span> <span class="param-type">(string, optional)</span>: Filter by entry type (receive/withdraw)</li>
                <li><span class="param-name">min_confirmations</span> <span class="param-type">(integer, optional)</span>: Minimum number of confirmations</li>
                <li><span class="param-name">per_page</span> <span class="param-type">(integer, default: 50)</span>: Number of results per page</li>
                <li><span class="param-name">page</span> <span class="param-type">(integer, default: 1)</span>: Page number</li>
            </ul>
        </div>
    </div>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/listings/seller/{seller_address}/transactions</span>
        <p>Get all transactions for a seller's listings</p>
        <div class="params">
            <h4>Path Parameters:</h4>
            <ul>
                <li><span class="param-name">seller_address</span> <span class="param-type">(string)</span>: The seller's address</li>
            </ul>
            <h4>Query Parameters:</h4>
            <ul>
                <li><span class="param-name">asset_name</span> <span class="param-type">(string, optional)</span>: Filter by asset name</li>
                <li><span class="param-name">entry_type</span> <span class="param-type">(string, optional)</span>: Filter by entry type (receive/withdraw)</li>
                <li><span class="param-name">min_confirmations</span> <span class="param-type">(integer, optional)</span>: Minimum number of confirmations</li>
                <li><span class="param-name">per_page</span> <span class="param-type">(integer, default: 50)</span>: Number of results per page</li>
                <li><span class="param-name">page</span> <span class="param-type">(integer, default: 1)</span>: Page number</li>
            </ul>
        </div>
    </div>

    <h2 id="orders">Order Endpoints</h2>

    <div class="endpoint">
        <span class="method post">POST</span>
        <span class="path">/listings/{listing_id}/orders</span>
        <p>Create a new order for a listing</p>
        <div class="params">
            <h4>Path Parameters:</h4>
            <ul>
                <li><span class="param-name">listing_id</span> <span class="param-type">(string)</span>: The listing's UUID</li>
            </ul>
            <h4>Request Body:</h4>
            <pre>
{
    "buyer_address": "string",
    "items": [
        {
            "asset_name": "string",
            "amount": "decimal"
        }
    ]
}</pre>
            <h4>Response:</h4>
            <pre>
{
    "id": "string (UUID)",
    "listing_id": "string (UUID)",
    "buyer_address": "string",
    "payment_address": "string",
    "status": "string",
    "created_at": "string (ISO datetime)",
    "updated_at": "string (ISO datetime)",
    "items": [
        {
            "asset_name": "string",
            "amount": "decimal",
            "price_evr": "decimal",
            "fee_evr": "decimal"
        }
    ],
    "balances": [
        {
            "asset_name": "string",
            "confirmed_balance": "decimal",
            "pending_balance": "decimal"
        }
    ],
    "total_price_evr": "decimal",
    "total_fee_evr": "decimal",
    "total_payment_evr": "decimal"
}</pre>
        </div>
    </div>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/orders/{order_id}</span>
        <p>Get order details by ID</p>
        <div class="params">
            <h4>Path Parameters:</h4>
            <ul>
                <li><span class="param-name">order_id</span> <span class="param-type">(string)</span>: The order's UUID</li>
            </ul>
        </div>
    </div>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/orders/{order_id}/balances</span>
        <p>Get order payment balances</p>
        <div class="params">
            <h4>Path Parameters:</h4>
            <ul>
                <li><span class="param-name">order_id</span> <span class="param-type">(string)</span>: The order's UUID</li>
            </ul>
            <h4>Response:</h4>
            <pre>
{
    "asset_name": {
        "confirmed_balance": "decimal",
        "pending_balance": "decimal"
    }
}</pre>
        </div>
    </div>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/orders</span>
        <p>Search orders with various filters</p>
        <div class="params">
            <h4>Query Parameters:</h4>
            <ul>
                <li><span class="param-name">buyer_address</span> <span class="param-type">(string, optional)</span>: Filter by buyer address</li>
                <li><span class="param-name">listing_id</span> <span class="param-type">(string, optional)</span>: Filter by listing ID</li>
                <li><span class="param-name">status</span> <span class="param-type">(string, optional)</span>: Filter by order status</li>
                <li><span class="param-name">per_page</span> <span class="param-type">(integer, default: 50)</span>: Number of results per page</li>
                <li><span class="param-name">page</span> <span class="param-type">(integer, default: 1)</span>: Page number</li>
            </ul>
        </div>
    </div>

    <h2 id="cart">Cart Order Endpoints</h2>

    <div class="endpoint">
        <span class="method post">POST</span>
        <span class="path">/cart/orders</span>
        <p>Create a new cart order for multiple listings</p>
        <div class="params">
            <h4>Request Body:</h4>
            <pre>
{
    "buyer_address": "string",
    "items": [
        {
            "listing_id": "string (UUID)",
            "asset_name": "string",
            "amount": "decimal"
        }
    ]
}</pre>
            <h4>Response:</h4>
            <pre>
{
    "id": "string (UUID)",
    "buyer_address": "string",
    "payment_address": "string",
    "status": "string",
    "created_at": "string (ISO datetime)",
    "updated_at": "string (ISO datetime)",
    "items": [
        {
            "listing_id": "string (UUID)",
            "listing_name": "string",
            "seller_address": "string",
            "asset_name": "string",
            "amount": "decimal",
            "price_evr": "decimal",
            "fee_evr": "decimal"
        }
    ],
    "balances": [
        {
            "asset_name": "string",
            "confirmed_balance": "decimal",
            "pending_balance": "decimal"
        }
    ],
    "total_price_evr": "decimal",
    "total_fee_evr": "decimal",
    "total_payment_evr": "decimal"
}</pre>
        </div>
    </div>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/cart/orders/{cart_order_id}</span>
        <p>Get cart order details by ID</p>
        <div class="params">
            <h4>Path Parameters:</h4>
            <ul>
                <li><span class="param-name">cart_order_id</span> <span class="param-type">(string)</span>: The cart order's UUID</li>
            </ul>
        </div>
    </div>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/cart/orders/{cart_order_id}/balances</span>
        <p>Get cart order payment balances</p>
        <div class="params">
            <h4>Path Parameters:</h4>
            <ul>
                <li><span class="param-name">cart_order_id</span> <span class="param-type">(string)</span>: The cart order's UUID</li>
            </ul>
            <h4>Response:</h4>
            <pre>
{
    "asset_name": {
        "confirmed_balance": "decimal",
        "pending_balance": "decimal"
    }
}</pre>
        </div>
    </div>

    <h2 id="management">Listing Management Endpoints</h2>

    <div class="endpoint">
        <span class="method post">POST</span>
        <span class="path">/listings</span>
        <p>Create a new listing</p>
        <div class="params">
            <h4>Request Body:</h4>
            <pre>
{
    "seller_address": "string",
    "name": "string",
    "description": "string (optional)",
    "image_ipfs_hash": "string (optional)",
    "prices": [
        {
            "asset_name": "string",
            "price_evr": "decimal (optional)",
            "price_asset_name": "string (optional)",
            "price_asset_amount": "decimal (optional)",
            "ipfs_hash": "string (optional)"
        }
    ],
    "tags": ["string"] (optional)
}</pre>
        </div>
    </div>

    <div class="endpoint">
        <span class="method post">POST</span>
        <span class="path">/listings/by-id/{listing_id}</span>
        <p>Update an existing listing</p>
        <div class="params">
            <h4>Path Parameters:</h4>
            <ul>
                <li><span class="param-name">listing_id</span> <span class="param-type">(string)</span>: The listing's UUID</li>
            </ul>
            <h4>Request Body:</h4>
            <pre>
{
    "name": "string (optional)",
    "description": "string (optional)",
    "image_ipfs_hash": "string (optional)",
    "tags": ["string"] (optional),
    "prices": [
        {
            "asset_name": "string",
            "price_evr": "decimal (optional)",
            "price_asset_name": "string (optional)",
            "price_asset_amount": "decimal (optional)",
            "ipfs_hash": "string (optional)",
            "units": "integer (optional, default: 8)"
        }
    ] (optional)
}</pre>
            <h4>Notes:</h4>
            <ul>
                <li>All fields are optional - only specified fields will be updated</li>
                <li>For prices, you can specify either <code>price_evr</code> OR (<code>price_asset_name</code> AND <code>price_asset_amount</code>)</li>
                <li>Tags will be stored as a comma-separated string internally</li>
                <li>The units field specifies decimal places for the asset (defaults to 8)</li>
                <li>Existing prices not included in the update will remain unchanged</li>
            </ul>
            <h4>Response:</h4>
            <pre>
{
    "id": "string (UUID)",
    "seller_address": "string",
    "listing_address": "string",
    "deposit_address": "string",
    "name": "string",
    "description": "string",
    "image_ipfs_hash": "string",
    "status": "string",
    "created_at": "string (ISO datetime)",
    "updated_at": "string (ISO datetime)",
    "prices": [
        {
            "asset_name": "string",
            "price_evr": "string (decimal)",
            "price_asset_name": "string",
            "price_asset_amount": "string (decimal)",
            "ipfs_hash": "string",
            "units": "integer",
            "created_at": "string (ISO datetime)",
            "updated_at": "string (ISO datetime)"
        }
    ],
    "balances": [
        {
            "asset_name": "string",
            "confirmed_balance": "string (decimal)",
            "pending_balance": "string (decimal)",
            "units": "integer",
            "last_confirmed_tx_hash": "string",
            "last_confirmed_tx_time": "string (ISO datetime)",
            "created_at": "string (ISO datetime)",
            "updated_at": "string (ISO datetime)"
        }
    ]
}</pre>
            <h4>Error Responses:</h4>
            <ul>
                <li><code>404 Not Found</code>: If listing doesn't exist</li>
                <li><code>400 Bad Request</code>: If price specification is invalid</li>
                <li><code>400 Bad Request</code>: If asset validation fails</li>
                <li><code>500 Internal Server Error</code>: For unexpected errors</li>
            </ul>
            <h4>Example:</h4>
            <pre>
# Update listing name and add a price for CREDITS
curl -X POST "http://localhost:8000/listings/by-id/YOUR_LISTING_ID" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Updated Name",
    "prices": [
      {
        "asset_name": "CREDITS",
        "price_evr": 150.0,
        "units": 8
      }
    ]
  }'</pre>
        </div>
    </div>

    <div class="endpoint">
        <span class="method delete">DELETE</span>
        <span class="path">/listings/by-id/{listing_id}</span>
        <p>Delete a listing</p>
        <div class="params">
            <h4>Path Parameters:</h4>
            <ul>
                <li><span class="param-name">listing_id</span> <span class="param-type">(string)</span>: The listing's UUID</li>
            </ul>
        </div>
    </div>

    <h2 id="operations">Listing Operations</h2>

    <div class="endpoint">
        <span class="method post">POST</span>
        <span class="path">/listings/{listing_id}/withdraw</span>
        <p>Withdraw assets from a listing</p>
        <div class="params">
            <h4>Path Parameters:</h4>
            <ul>
                <li><span class="param-name">listing_id</span> <span class="param-type">(string)</span>: The listing's UUID</li>
            </ul>
            <h4>Request Body:</h4>
            <pre>
{
    "asset_name": "string",
    "amount": "decimal",
    "to_address": "string"
}</pre>
            <h4>Response:</h4>
            <pre>
{
    "tx_hash": "string",
    "amount": "string (decimal)",
    "asset_name": "string",
    "from_address": "string",
    "to_address": "string"
}</pre>
        </div>
    </div>

    <h2 id="testing">Testing Endpoints</h2>

    <div class="endpoint">
        <span class="method get">GET</span>
        <span class="path">/test/create-listing</span>
        <p>Create a test listing with sample data and real addresses</p>
        <div class="params">
            <p>This endpoint creates a test listing with:</p>
            <ul>
                <li>New Evrmore addresses for seller and listing</li>
                <li>Sample asset prices and balances</li>
                <li>Test data for development purposes</li>
            </ul>
            <h4>Response:</h4>
            <p>Returns the created listing object</p>
        </div>
    </div>

    <h2 id="formats">Response Formats</h2>

    <h3>Listing Object</h3>
    <div class="response">
        <pre>
{
    "id": "string (UUID)",
    "seller_address": "string",
    "listing_address": "string",
    "deposit_address": "string",
    "name": "string",
    "description": "string",
    "image_ipfs_hash": "string",
    "status": "string",
    "tags": ["string"],
    "created_at": "string (ISO datetime)",
    "updated_at": "string (ISO datetime)",
    "prices": [
        {
            "asset_name": "string",
            "price_evr": "string (decimal)",
            "price_asset_name": "string",
            "price_asset_amount": "string (decimal)",
            "ipfs_hash": "string",
            "units": "integer",
            "created_at": "string (ISO datetime)",
            "updated_at": "string (ISO datetime)"
        }
    ],
    "balances": [
        {
            "asset_name": "string",
            "confirmed_balance": "string (decimal)",
            "pending_balance": "string (decimal)",
            "units": "integer",
            "last_confirmed_tx_hash": "string",
            "last_confirmed_tx_time": "string (ISO datetime)",
            "created_at": "string (ISO datetime)",
            "updated_at": "string (ISO datetime)"
        }
    ]
}</pre>
    </div>

    <h3>Transaction Object</h3>
    <div class="response">
        <pre>
{
    "tx_hash": "string",
    "address": "string",
    "entry_type": "string (receive/withdraw)",
    "asset_name": "string",
    "amount": "string (decimal)",
    "fee": "string (decimal)",
    "confirmations": "integer",
    "time": "string (ISO datetime)",
    "asset_type": "string",
    "asset_message": "string",
    "vout": "integer",
    "trusted": "boolean",
    "bip125_replaceable": "boolean",
    "abandoned": "boolean",
    "created_at": "string (ISO datetime)",
    "updated_at": "string (ISO datetime)",
    "listing_id": "string (UUID, only in seller transactions)",
    "listing_name": "string (only in seller transactions)"
}</pre>
    </div>

    <h3>Paginated Response</h3>
    <div class="response">
        <pre>
{
    "items": [...],
    "total_count": "integer",
    "metadata": {
        "limit": "integer",
        "offset": "integer",
        "page": "integer",
        "total_pages": "integer"
    }
}</pre>
    </div>

    <h3>Error Response</h3>
    <div class="response">
        <pre>
{
    "detail": "string (error message)"
}</pre>
    </div>

</body>
</html>

